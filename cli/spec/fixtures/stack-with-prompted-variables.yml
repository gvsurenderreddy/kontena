stack: user/stackname
version: 0.1.1
variables:
  wp_pass:
    type: secret # has a callback that writes the value to vault
    required: true
    min_length: 10
    empty_is_nil: true
    secret: &wp_admin_secret  # standard yaml anchoring, handled by YAML.load
      secret: WP_ADMIN_PASSWORD
      name: WORDPRESS_PASSWORD
      type: env
    from: 
      vault: WP_ADMIN_PASSWORD # first try to get WP_ADMIN_PASSWORD from vault
      env: WORDPRESS_DB_PASSWORD # then try from local env
      prompt: Enter a password for your wordpress or leave empty to generate random # then prompt
      random_string: # if prompt returned nil, generate a random string
        length: 10
        charset: ascii_printable
  test_var:
    type: string
    from:
      random_string:
        length: 16
        charset: hex
services:
  wordpress:
    extends:
      file: docker-compose_v2.yml
      service: wordpress
    image: wordpress:$TAG
    stateful: true
    secrets: 
      - *wp_admin_secret # starnard yaml referencing, handled by YAML.load
      - secret: FOO
        name: FOOFOO
        type: env
    instances: 2
    deploy:
      strategy: ha
  mysql:
    extends:
      file: docker-compose_v2.yml
      service: mysql
    image: ${MYSQL_IMAGE}
    stateful: true
    secrets: 
      - secret: WP_MYSQL_ROOT_PW
        name: MYSQL_PASSWORD
        type: env
    environment:
      - INTERNAL_VAR=$$INTERNAL_VAR
      - RANDOM_VAR=${test_var}

